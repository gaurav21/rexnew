jQuery.extend({
    mValidate: function(options) {
        var panelOrientation;
       var jmediaquery = window.matchMedia( "(min-width: 980px)" )
if (jmediaquery.matches) {
      panelOrientation = 'right';
}
else {
      panelOrientation = 'top';

}

        var NoError = true;
        var NoError3 = true;
        var emailReg = /^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;
        options.thatForm.find(options.errorContainer).empty();
        options.thatForm.find('input, div').removeClass('error');
        options.thatForm.find('input, div').removeClass('text-warning');
        $.each(options.thatForm.find('input, div'), function(index, value) {
            //$(value).popover('hide');
        });
        $('select, div').removeClass('selectError_medium');

        $.each(options.requiredFields, function(key, field) {
            switch (field.type) {
                case 'email':
                    if ($('#' + key).val() == '' || !emailReg.test($('#' + key).val())) {
                        showError(key, field.errorClass, false, field.hasOwnerrorMessage, field.errorMessage);
                        NoError = false;
                    }
                    break;
                case 'password':
                    if ($('#' + key).val().length < 6) {
                        showError(key, field.errorClass, false, field.hasOwnerrorMessage, field.errorMessage);
                        NoError = false;
                    }
                    if (field.compare) {
                        if ($('#' + key).val() !== $('#' + field.compare).val()) {
                            showError(field.compare, field.errorClass, false, field.hasOwnerrorMessage, field.errorMessageNotConfirmed);
                            NoError = false;
                        }
                    }
                    break;
                case 'select':
                    if ($('#' + key).val() == "0" || !$('#' + key).val()) {
                        showError(key, field.errorClass, true, field.hasOwnerrorMessage, field.errorMessage);
                        NoError = false;
                    }
                    break;
                case 'text':
                    if (field.required == true && $('#' + key).val().length < 2) {
                        showError(key, field.errorClass, false, field.hasOwnerrorMessage, field.errorMessage);
                        NoError = false;
                    }
                    break;
                case 'checkbox':
                    if (!$("#" + key).is(':checked')) {
                        showError(key, field.errorClass, false, field.hasOwnerrorMessage, field.errorMessage);
                        $("span.terms").addClass(field.errorClass)
                        NoError = false;
                    }
                    break;
            }


        });


        function showError(element, errorclass, isSelect, ownerror, errormessage) {
            var _popover;

            $("#" + element).addClass(errorclass);
            $("#" + element).parent().find('label').css('color', '#db171c');
            $("#" + element).attr('title', errormessage);
            _popover = $("#" + element).popover({
                trigger: "manual",
                placement: panelOrientation,
                //  content: ,
                template: "<div class=\"popover\"><div class=\"arrow\"></div><div class=\"popover-inner\">" + errormessage + "<div class=\"popover-content\"><p></p></div></div></div>"
            });
            // Bootstrap 3:



            return $("#" + element).popover("show");
        }

        if (NoError === false) {
            options.thatForm.find(options.errorContainer).show();
            if (options.UseFormErrorMessage === true)
                options.thatForm.find(options.errorContainer).append('<span class="error">' + options.thatForm.attr('data-title') + '</span>');

            if (NoError3 == false) {
                options.thatForm.find(options.errorContainer).append('<span class="error">' + options.OnlyLatinText + '</span>');
            }


            return false;
        }
        else {
            options.thatForm.submit();

        }

    }
});


